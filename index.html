<!DOCTYPE html>
<html lang="en" >

<head>
  <meta charset="UTF-8">
  <title>A Pen by  Alex F</title>
  
  <link rel="stylesheet" href="css/style.css">

  
</head>

<body>

	<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/89/three.min.js'></script>
	<script src="./bower_components/stellar-sdk/stellar-sdk.min.js"></script>

	<script src="js/dependencies/jquery.min.js"></script>
	<script src="js/dependencies/vue.js"></script>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js%22%3E"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.bundle.min.js"></script>
	<script src="https://unpkg.com/ionicons@4.2.4/dist/ionicons.js"></script>

	<script src="js/dependencies/require.js"></script>
	<script src="js/dependencies/underscore-min.js"></script>
	<script src="js/webgl/OrbitControls.js"></script>
	<script src="js/webgl/Projector.js"></script>
	<script src="js/webgl/CanvasRenderer.js"></script>
	<script src="js/dependencies/stats.min.js"></script>
	<script src="js/dependencies/tween.min.js"></script>
	<script src='js/webgl/LineSegmentsGeometry.js'></script>
	<script src='js/webgl/LineGeometry.js'></script>
	<script src='js/webgl/WireframeGeometry2.js'></script>

	<script src='js/webgl/LineMaterial.js'></script>

	<script src='js/webgl/LineSegments2.js'></script>
	<script src='js/webgl/Line2.js'></script>
	<script src='js/webgl/Wireframe.js'></script>
	
	<!-- index -->
	<script src="js/webgl/inflate.min.js"></script>
	<script src="js/loaders/FBXLoader.js"></script>
	<script  src="js/webgl/OutlineEffect.js"></script>
	<script  src="js/webgl/shootingstar.js"></script>
	<script  src="js/horizon.js"></script>
	<script  src="js/stream.js"></script>
	<script  src="js/trip.js"></script>
	<script  src="js/index.js"></script>

	
	<div id="layout" class="stars">
	 	<div id="ShootingStarParams"></div>
	</div> 
	<!-- <img src="Stellar-Logo.png" class="stellar_logo"> -->

	<div id="app">

		<div class="icon-bar">
		  <a class="active" href="#"><i class="fa fa-home"></i></a>
		  <a href="#"><i class="fa fa-search"></i></a>
		  <a v-on:click="showRequestHistoryWindow()" href="#"><i class="fa fa-history"></i></a>
		  <a v-on:click="showAccountWindow()" href="#"><i class="fa fa-book"></i></a>
		  <a v-on:click="showLegendWindow()" href="#"><i class="fa fa-question"></i></a>
		</div>

		<button v-show="accountView" v-on:click="globalView()" id="back_button" class="raise">Back</button>

		<div v-show="showAccountWin" id="account" class="container p-t-md">
			<ion-icon v-on:click="closeAccountWindow()" id="accountClose" name="close" style="float: right;"></ion-icon>
			<div class="account-title"> Account - {{ accountViewID  }}</div>
			<div class="pie-chart">
				Assets (USD)
				<canvas id="myChart"></canvas>
			</div>
			<div class="pie-chart">
				Trade Distribution
				<canvas id="tradesChart"></canvas>
			</div>
			<div class="account-info"> 
				<span> <b>Payments sent:</b> {{ payments_sent }} </span>
				<span> <b>Payments received:</b> {{ payments_received }} </span>
				<span> <b>Trades completed:</b> {{ trades_completed }} </span>
				<span> <b>Most Traded Asset:</b> {{ most_traded }} </span>
			</div>

			<div id="account-menu" style="border-radius: 4px;">
				<ul role="tablist" class="nav nav-tabs" id="account-tabs">
					<li role="presentation" class="nav-item active"><a id="account-tabs-tab-balances" class="nav-link active" data-toggle="tab" role="tab" aria-controls="account-tabs-pane-balances" aria-selected="true" href="#balances">Balances</a></li>

					<li role="presentation" class="nav-item"><a id="account-tabs-tab-payments" class="nav-link" href="#payments_tab" data-toggle="tab" role="tab" aria-controls="account-tabs-pane-payments" tabindex="-1" aria-selected="false">Payments</a></li>

					<li role="presentation" class="nav-item"><a id="account-tabs-tab-offers" class="nav-link" href="#offers_tab" data-toggle="tab" role="tab" aria-controls="account-tabs-pane-offers" tabindex="-1" aria-selected="false">Offers</a></li>

					<li role="presentation" class="nav-item"><a id="account-tabs-tab-trades" class="nav-link" href="#trades_tab" data-toggle="tab" role="tab" aria-controls="account-tabs-pane-trades" tabindex="-1" aria-selected="false" >Trades</a></li>

					<li role="presentation" class="nav-item"><a id="account-tabs-tab-operations" class="nav-link" data-toggle="tab" role="tab" aria-controls="account-tabs-pane-operations" tabindex="-1" aria-selected="false" href="#operations_tab">Operations</a></li>

					<li role="presentation" class="nav-item"><a id="account-tabs-tab-transactions" class="nav-link" data-toggle="tab" data-url="?action=transactions" role="tab" aria-controls="account-tabs-pane-transactions" tabindex="-1" aria-selected="false" href="#transactions_tab">Transactions</a></li>
				</ul>
				<div class="tab-content">
					<div id="balances" class="tab-pane active"></div>
					<div id="payments_tab" class="tab-pane fade"></div>
					<div id="offers_tab" class="tab-pane fade"></div>
					<div id="operations_tab" class="tab-pane fade"></div>
					<div id="transactions_tab" class ="tab-pane fade"></div>
					<div id="trades_tab" class="tab-pane fade"> </div>

				</div>
			</div>
			<div id="assets"></div>

			<div id="address"></div>
		</div>

		<div v-show="showRequestHistory" class="request-history">
			<div class="request-title">Request History</div>
			<!--<div class='request-container'>
			  <ul class='request-labels' id="request-list"></ul>
			</div> -->
			<table id="request-table" class="table table-dark table-hover table-condensed"><thead><tr><th id="request-operation">Operation</th><th id="request-details">Operation</th><th id="request-transaction">Transaction</th><!--<th id="request-time">Time</th>--></tr></thead><tbody id="request-body"> </tbody> </table>
		</div>

		<div v-show="showLegend" class='my-legend'>
			<div class='legend-title'>Stellar Assets Legend</div>
			<div class='legend-scale'>
			  <ul class='legend-labels' id="asset-list"></ul>
			</div>
		</div>

		<div class="buttons" >
			<!-- <h1>Live Mode</h1> -->
			<button id="transactions_stream" class="raise">Transactions</button>
			<button id="payments_stream" class="raise" >Payments</button>
			<button id="operations_stream" class="raise">Operations</button>
			<button id="trades_stream" class="raise">Trades</button>
			<button id="effects_stream" class="raise">Effects</button>
		</div>
	 
		<div id="description" style="display:none">

		<h1>Description</h1>
		<!-- <p> this is the description</p> -->
		<div id="description_lines">
		<!-- Append here -->
		</div>

		</div>
	
	</div>


</body>

</html>

<script type="text/javascript">
var app = new Vue({
  el: '#app',
  data: {
    message: 'Hello Vue!',
    showVue: false,
    showAccountWin: false,
    showRequestHistory: false,
    showLegend: false,
    showTx: false,
    messageList: [],
	accountList: [] ,
	accountViewID: "",
	accountViewObj: {},
	accountView: false,
	switchToGlobalView: false,
	requestCount: 0,
	payments_sent: 0,
	payments_received: 0,
	trades_completed: 0,
	most_traded: "",
	found: false,
	assetID: "",
	num_assets: 0,
	num_expected: 0,
	datasets: [],
	innerData: [],
	backgroundColor: [],
	labels: [],
	wireframe: "",
	imgArray: ["images/Oasis-EQUIRECTANGULAR-6-1024x512.png", "images/Ice-EQUIRECTANGULAR-1-1024x512.png", "images/Wetlands-Clouds-EQUIRECTANGULAR-1-1024x512.png"]
  },
  methods: {
  	showText: function() {
  		this.showVue = !this.showVue;
  	},
  	showAccountWindow: function() {
  		//fix the case where you toggle the window off then click on another planet
  		this.hideAll();
		this.showAccountWin = true;
  		
  	},
  	closeAccountWindow: function() {
  		this.showAccountWin = false;
  	},
  	showRequestHistoryWindow: function() {
  		
  		if(this.showRequestHistory) {
  			this.showRequestHistory = false;
  		} else {
	  		this.hideAll();
  			this.showRequestHistory = true;
	  	}
  	},
  	showLegendWindow: function() {
  		if(this.showLegend) {
  			this.showLegend = false;
  		} else {
	  		this.hideAll();
	  		this.showLegend = true;
	  	}
  	},
  	hideAll: function() {
  		this.showRequestHistory = false;
  		this.showAccountWin = false;
  		this.showLegend = false;
  	},
  	globalView: function() {
  		this.showAccountWin = false;
  		this.accountView = false;
  		this.switchToGlobalView = true;
  	},
  	operationMessage: function(message) {
  		var type = message.type;
  		var display;
  		//print out basic message detailing operation
  		if(type == "payment") {
  			display = "[" + message.from.substring(0,4) + "]" + " sent " + message.amount + " " + this.assetString(message) + " to " + "[" + message.to.substring(0,4) + "]"; 
  		} else if(type == "manage_offer") {
  			display = "[" + message.source_account.substring(0,4) + "] " + " wants to trade " + message.amount.substring(0,6) + " " + this.sellingAssetString(message)   + " FOR " + this.buyingAssetAmount(message) + " " + this.buyingAssetString(message);
  		} else {
  			display = "idk lol";
  		}

  		return display;
  	},
  	assetString: function(message) {
  		var asset;

  		if(message.asset_code) {
  			asset = message.asset_code;
  		} else if(message.asset_type == "native") {
  			asset = "XLM";
  		} else {
  			asset = message.asset_type;
  		}

  		return asset;
  	},
  	sellingAssetString: function(message) {
  		var asset;

  		if(message.selling_asset_code) {
  			asset = message.selling_asset_code;
  		} else if(message.selling_asset_type == "native") {
  			asset = "XLM";
  		} else {
  			asset = message.selling_asset_type;
  		}

  		return asset;
  	},
  	buyingAssetString: function(message) {
  		var asset;

  		if(message.buying_asset_code) {
  			asset = message.buying_asset_code;
  		} else if(message.buying_asset_type == "native") {
  			asset = "XLM";
  		} else {
  			asset = message.buying_asset_type;
  		}

  		return asset;
  	},
  	buyingAssetAmount: function(message) {
  		var buying_amount = message.amount * message.price;

  		if(buying_amount > 0.01) {
    		buying_amount = Math.round(buying_amount * 100) / 100;
  		} else {
  			buying_amount = Math.round(buying_amount * 100000) / 100000;
  		}

    	return buying_amount;
  	},
  	buildPieChart: function(assets) {

  		app.datasets = [];
  		app.backgroundColor = [];
  		app.innerData = [];
  		app.labels = [];

  		app.num_assets = 0;
  		app.num_expected = assets.length;

  		for(var a in assets) {

			var asset = assets[a];

			var code;
			var usd_value = 0;
			var asset_id = "";
			var ajax;

			//console.log(asset);

			
			if(asset.asset_code) {
	            code = asset.asset_code;
	        } else {
	        	if(asset.asset_type == "native") {
	        		code = "XLM";
	        	} else {
	        		code = asset.asset_type;
	        	}      
	        }

	        //asset_id = app.convertToUsd(code, asset.balance);

	        app.assetToUsd(code, asset.balance);

	        /*
	        if(asset_id) {
	        	usd_value = app.getUsdValue(asset_id);
	        	console.log(usd_value);
	        }*/
	    } 


  	},
  	assetToUsd: function(asset, amount) {
  		var usd_value = 0;

  		$.ajax({
	        url: "https://min-api.cryptocompare.com/data/price?fsym=" + asset + "&tsyms=USD",
	        success: function(result) {
	        	//console.log(result);
	        	app.num_assets++;
	        		
        		//console.log("Searched cryptocompare for " + asset + " and found: " + result.USD);

        		usd_value = result.USD * amount;

        		usd_value = Math.round(usd_value * 100) / 100;
    

        		//console.log(amount + " " + asset + " is worth $" + usd_value + " USD" );

        		if(usd_value > 1) {
        			app.addChartData(asset, amount, usd_value);
        		}
	        },
	        error: function(result) {
	        	app.num_assets++;
	        }
    	});
  	},
  	addChartData: function(asset, amount, usd_value) {
  		var colour;

  		app.innerData.push(usd_value);
    	app.labels.push(asset);

    	if(asset_colours.hasOwnProperty(asset)) {
			colour = asset_colours[asset];
		} else {
			var x = Math.round(0xffffff * Math.random()).toString(16);
			var y = (6-x.length);
			var z = "000000";
			var z1 = z.substring(0,y);
			colour= "#" + z1 + x;
		}

		app.backgroundColor.push(colour);
	}		
  }
})

</script>